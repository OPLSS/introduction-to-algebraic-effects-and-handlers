# Algebraic effects and handlers

These are the notes and materials for the lectures on algebraic effects and
handlers at the [Oregon programming languages summer school 2018
(OPLSS)](https://www.cs.uoregon.edu/research/summerschool/summer18/index.php).

## Resources

* [Effects bibliography](https://github.com/yallop/effects-bibliography)
* [Effects Rosetta Stone](https://github.com/effect-handlers/effects-rosetta-stone)
* [Programming language Eff](http://www.eff-lang.org)
* [Formalized proofs about Eff](https://github.com/matijapretnar/proofs/)

## Lecture 1: What is algebraic about algebraic effects and handlers?

The purpose of the first lecture is to review algebraic theories and related
concepts, and connect them with computational effects. We shall start on the
mathematical side of things and gradually derive from it a programming language.

The contents of this lecture is a bit ambitious. It is likely that the part
about comodels will spill over to the second lecture.

### Outline

* signatures, terms, and algebraic theories
* models of an algebraic theory
* free models of an algebraic theory
* generalization to parameterized operations with arbitrary arities
* sequencing and generic operations
* handlers
* comodels and tensoring of comodels and models

### Reading material

Pretty much everything that will be said in the first lecture is written up in
[What is algebraic about algebraic effects and
handlers?](https://arxiv.org/abs/1807.05923), which still a bit rough around the
edges, so if you see a typo please [let me know](https://github.com/andrejbauer/what-is-algebraic-about-algebraic-effects).

### Problems

#### Problem: the theory of passing time

Formulate an algebraic theory `Time` in which we can explicitly record passage
of time, i.e., there is an operation that makes one "tick" of the clock. Give an
explicit description of the free model of the theory, generated by a set `X`.

Suppose we wanted a computational effect which sets an upper limit on how much
time a comptation is allowed to use, i.e., a computation aborts if it performs
more than a given fixed number `n` of ticks. Extend the theory `Time` to give
such a theory. Give an explicit description of its free models.

#### Problem: the theory of partial maps

The models of the empty theory are precisely sets and functions. Is there a
theory whose models form (a category equivalent to) the category of sets and
*partial* functions?

Recall that a partial function `f : A ⇀ B` is an ordinary function `f : S → B`
defined on a subset `S ⊆ A`. (How do we define composition of partial
functions?)


#### Problem: Morita equivalence

It may happen that two theories `T₁` and `T₂` have equivalent categories of models, i.e.,

    Mod(T₁) ≃ Mod(T₂)

In such a case we say that `T₁` and `T₂` are **Morita equivalent**.

Let `T` be an algebraic theory and `t` a term in context `x₁, …, xᵢ`. Define a
**definitional extension `T+[op:=t]`** to be the theory `T` extended with
an additional operation `op` and equation

    x₁, …, xᵢ | op(x₁, …, xᵢ) = t

We say that `op` is a **defined operation**.

**Problem:** Confirm the intuitive feeling that `T+[op:=t]` by proving that `T`
and `T+[op:=t]` are Morita equivalent.

**Problem:** Formulate the idea of a definitional extension so that we allow an
arbitrary set of defined operations, and show that we still have Morita
equivalence.

### Problem: the theory of a set

Given any set `A`, define the **theory `T(A)` of the set `A`** as follows:

* for every `n` and every map `f : Aⁿ → A`, `op(f)` is an `n`-ary operation
* for all `f : Aⁱ → A`, `g : Aʲ → A` and `h₁, …, hᵢ : Aʲ → A`, if

        f ∘ (h₁, …, hᵢ) = g

  then we have an equation

        x₁, …, xⱼ | op(f)(op(h₁)(x₁,…,xⱼ), …, hᵢ(x₁,…,xⱼ)) = g(x₁, …, xⱼ)

**Problem:** Is `T({0,1})` Morita equivalent to another, well-known algebraic theory?

#### Problem: a comodel for non-determinism

In [Example 4.6 of the reading material](https://arxiv.org/abs/1807.05923) it is
shown that there is no comodel of non-determinism in the category of sets. Can
you suggest a category in which we get a reasonable comodel of non-determinism?

#### Problem: formalization of algebric theories

If you prefer avoiding doing Real Math, you can formalize algebraic theories and
their comodels in your favorite proof assisant. A possible starting point is
[this
gist](https://gist.github.com/andrejbauer/3cc438ab38646516e5e9278fdb22022c), and
a good goal is the construciton of the free model of a theory generated by a set
(or a type).

Because the free model requires quotienting, you should think ahead on how you
are going to do that. Some possibilities are:

* use homotopy type theory and make sure that the types involved are h-Sets
* use setoids
* suggest your own solution

It may be wiser to first show as a warm-up exercise that theories without
equations have initial models, as that only requires the construction of
well-founded trees (which are inductive types).


## Lecture 2: Designing a programming language

In the second lecture we shall focus on properly defining a core programming
language with algebraic effects and handlers, starting from 

* Syntax of core eff
* Operational semantics
* An effect system
* Progress & preservation
* Implementation

Reading material: [An effect system for algebraic effects and handlers](https://arxiv.org/abs/1306.6316).

## Lecture 4: Programming with algebraic effects and handlers

Introduction to algebraic effects and handlers for programmers.

Reading material: [An introduction to algebraic effects and
handlers](http://www.eff-lang.org/handlers-tutorial.pdf) and [Programming with
algebraic effects and handlers](https://arxiv.org/abs/1203.1539).

* State
* Non-determinism and search
* Transactional memory
* Probabilistic programming
* Cooperative multi-threading
